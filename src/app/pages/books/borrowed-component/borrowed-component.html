<div class="books-container">
    <h2>Borrowed books</h2>

    <p-table
        [value]="books"
        showGridlines
        stripedRows
        [loading]="isLoading"
        [paginator]="true"
        [rows]="10"
        [totalRecords]="totalElements"
        [lazy]="true"
        (onLazyLoad)="getBorrowedBooks($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} books"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        class="p-datatable-striped">

        <ng-template pTemplate="header">
            <tr>
                <th>Title</th>
                <th>Student</th>
                <th>ISBN</th>
                <th>Issued</th>
                <th>Expected</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-book>
            <tr>
                <td>
                    <strong>{{ book.title }}</strong>
                </td>
                <td>{{ book.name }}</td>
                <td>{{ book.isbn }}</td>
                <td>{{ book.dateIssued | date:'mediumDate' }}</td>
                <td>{{ book.expectedDate | date:'mediumDate' }}</td>
                <td>
                    <p-tag
                        [value]="book.borrowed ? 'Borrowed' : 'Available'"
                        [severity]="book.borrowed ? 'danger' : 'success'">
                    </p-tag>
                </td>

                <td>
                    @if (book.borrowed) {
                        <p-button
                            [loading]="isReturning"
                            pRipple
                            label="Return"
                            icon="pi pi-backward"
                            severity="primary"
                            size="small"
                            (onClick)="returnBook(book)">
                        </p-button>
                    }
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5" class="text-center">
                    <div class="p-4">
                        <i class="pi pi-info-circle" style="font-size: 2rem; color: var(--text-color-secondary)"></i>
                        <p class="mt-2 mb-0">No books found.</p>
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
            <tr>
                <td colspan="5" class="text-center">
                    <div class="p-4">
                        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
                        <p class="mt-2 mb-0">Loading books...</p>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
<p-toast />
